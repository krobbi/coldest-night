# NightScript Version 3.
# Menu Test
# Test for variables in menus.

func test_eq(test_name, test, control){
	if test == control {
		say(format("Test `{0}` passed! ({1}.)", test_name, control));
	} else {
		say(format("Test `{0}` failed!\nExpected {1}, got {2}.", test_name, control, test));
	}
}

freeze();
show();

var test_a = 100;
var test_b = 200;

menu {
	option "Foo" {}
	
	var outer_var = 123456;
	var value;
	
	menu {
		var i = 0;
		
		while i < 3 {
			var j = 1337;
			i = i + 1;
			
			say(format("Loop test {0} of 3", i));
			test_eq("nested_menu_pre_j", j, 1337);
			
			option format("Use value {0}", i) {
				var k = 9001;
				value = i;
				
				test_eq("nested_option_test_a", test_a, 100);
				test_eq("nested_option_test_b", test_b, 200);
				test_eq("nested_option_outer_var", outer_var, 123456);
				test_eq("nested_option_j", j, 1337);
				test_eq("nested_option_k", k, 9001);
			}
			
			test_eq("nested_menu_post_j", j, 1337);
		}
		
		test_eq("nested_menu_outer_var", outer_var, 123456);
		test_eq("nested_menu_i", i, 3);
	}
	
	option format("Bar {0}", value) {
		test_eq("bar_test_a", test_a, 100);
		test_eq("bar_test_b", test_b, 200);
		test_eq("bar_outer_var", outer_var, 123456);
	}
	
	test_eq("menu_test_a", test_a, 100);
	test_eq("menu_test_b", test_b, 200);
	test_eq("menu_outer_var", outer_var, 123456);
}

test_eq("post_test_a", test_a, 100);
test_eq("post_test_b", test_b, 200);

unfreeze();
hide();
